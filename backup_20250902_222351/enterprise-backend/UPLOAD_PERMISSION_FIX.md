# ç”Ÿäº§ç¯å¢ƒä¸Šä¼ å›¾ç‰‡æ¥å£500é”™è¯¯ä¿®å¤

## é—®é¢˜æè¿°

**é”™è¯¯ç°è±¡**: ç”Ÿäº§ç¯å¢ƒåå°ç®¡ç†ç³»ç»Ÿçš„ä¸Šä¼ å›¾ç‰‡æ¥å£è¿”å›500é”™è¯¯
- è¯·æ±‚URL: `https://catusfoto.top/api/upload/`
- è¯·æ±‚æ–¹æ³•: POST
- çŠ¶æ€ç : 500 Internal Server Error

## é—®é¢˜åˆ†æ

### 1. **æ ¹æœ¬åŸå› **
ç”Ÿäº§ç¯å¢ƒçš„è¿›ç¨‹ä»¥ `nginx` ç”¨æˆ·è¿è¡Œï¼Œä½†æ˜¯ä¸Šä¼ ç›®å½• `uploads/` çš„æ‰€æœ‰è€…æ˜¯ `501` ç”¨æˆ·ï¼Œå¯¼è‡´nginxç”¨æˆ·æ— æ³•å†™å…¥æ–‡ä»¶ã€‚

### 2. **æƒé™æ£€æŸ¥ç»“æœ**
```bash
# è¿›ç¨‹ç”¨æˆ·
nginx     122049  0.0  1.7 105920 13884 ?        Ss   00:03   0:33 /var/www/enterprise/enterprise-backend/venv/bin/python

# ç›®å½•æƒé™
drwxr-xr-x 2 501 games   8192 7æœˆ  31 21:30 uploads/

# æƒé™æµ‹è¯•
sudo -u nginx touch uploads/test_write.txt
# ç»“æœ: touch: æ— æ³•åˆ›å»º 'uploads/test_write.txt': æƒé™ä¸å¤Ÿ
```

### 3. **å½±å“èŒƒå›´**
- å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å®Œå…¨æ— æ³•ä½¿ç”¨
- åå°ç®¡ç†ç³»ç»Ÿæ— æ³•ä¸Šä¼ äº§å“å›¾ç‰‡ã€è½®æ’­å›¾ç­‰
- ç”¨æˆ·æ— æ³•é€šè¿‡å‰ç«¯ä¸Šä¼ å›¾ç‰‡

## è§£å†³æ–¹æ¡ˆ

### 1. **ä¿®å¤æƒé™**
```bash
# ä¿®å¤uploadsç›®å½•æƒé™
chown -R nginx:nginx /var/www/enterprise/enterprise-backend/uploads/
chmod -R 755 /var/www/enterprise/enterprise-backend/uploads/

# ä¿®å¤logsç›®å½•æƒé™
chown -R nginx:nginx /var/www/enterprise/enterprise-backend/logs/
chmod -R 755 /var/www/enterprise/enterprise-backend/logs/
```

### 2. **éªŒè¯ä¿®å¤**
```bash
# æƒé™æµ‹è¯•
sudo -u nginx touch uploads/test_write.txt
# ç»“æœ: æƒé™æµ‹è¯•æˆåŠŸ

# ä¸Šä¼ æ¥å£æµ‹è¯•
curl -X POST "https://catusfoto.top/api/upload/" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test_image.jpg"

# è¿”å›ç»“æœ
{
  "filename": "0e49c9fa-0ad8-4501-90f2-82b39a429d72.jpg",
  "url": "/uploads/0e49c9fa-0ad8-4501-90f2-82b39a429d72.jpg",
  "size": 15906,
  "content_type": "image/jpeg"
}
```

## é¢„é˜²æªæ–½

### 1. **æƒé™ä¿®å¤è„šæœ¬**
åˆ›å»ºäº† `fix_production_permissions.sh` è„šæœ¬ï¼Œç”¨äºï¼š
- è‡ªåŠ¨ä¿®å¤uploadså’Œlogsç›®å½•æƒé™
- éªŒè¯æƒé™è®¾ç½®æ˜¯å¦æ­£ç¡®
- æä¾›æƒé™æ£€æŸ¥å»ºè®®

### 2. **éƒ¨ç½²æ£€æŸ¥æ¸…å•**
åœ¨æ¯æ¬¡éƒ¨ç½²æ—¶åº”è¯¥æ£€æŸ¥ï¼š
- [ ] uploadsç›®å½•æƒé™ (nginxç”¨æˆ·å¯å†™)
- [ ] logsç›®å½•æƒé™ (nginxç”¨æˆ·å¯å†™)
- [ ] ä¸Šä¼ æ¥å£åŠŸèƒ½æµ‹è¯•
- [ ] æ–‡ä»¶è®¿é—®æƒé™æµ‹è¯•

### 3. **ç›‘æ§å»ºè®®**
- å®šæœŸæ£€æŸ¥nginxç”¨æˆ·å¯¹å…³é”®ç›®å½•çš„è®¿é—®æƒé™
- ç›‘æ§ä¸Šä¼ æ¥å£çš„é”™è¯¯æ—¥å¿—
- è®¾ç½®æ–‡ä»¶ç³»ç»Ÿæƒé™å˜æ›´çš„å‘Šè­¦

## æŠ€æœ¯ç»†èŠ‚

### 1. **æƒé™è®¾ç½®è¯´æ˜**
```bash
# ç›®å½•æƒé™: 755
# - æ‰€æœ‰è€…(nginx): è¯»(4) + å†™(2) + æ‰§è¡Œ(1) = 7
# - ç»„ç”¨æˆ·: è¯»(4) + æ‰§è¡Œ(1) = 5  
# - å…¶ä»–ç”¨æˆ·: è¯»(4) + æ‰§è¡Œ(1) = 5

# æ–‡ä»¶æƒé™: 644
# - æ‰€æœ‰è€…(nginx): è¯»(4) + å†™(2) = 6
# - ç»„ç”¨æˆ·: è¯»(4) = 4
# - å…¶ä»–ç”¨æˆ·: è¯»(4) = 4
```

### 2. **ç”¨æˆ·å’Œç»„è®¾ç½®**
```bash
# è¿›ç¨‹è¿è¡Œç”¨æˆ·
nginx

# ç›®å½•æ‰€æœ‰è€…
nginx:nginx

# å…³é”®ç›®å½•
/var/www/enterprise/enterprise-backend/uploads/
/var/www/enterprise/enterprise-backend/logs/
```

## æ€»ç»“

### âœ… **é—®é¢˜å·²è§£å†³**
- ä¸Šä¼ æ¥å£ç°åœ¨æ­£å¸¸å·¥ä½œ
- æƒé™è®¾ç½®æ­£ç¡®
- æ–‡ä»¶å¯ä»¥æ­£å¸¸ä¸Šä¼ å’Œè®¿é—®

### ğŸ“‹ **ä¿®å¤å†…å®¹**
1. ä¿®å¤äº†uploadsç›®å½•æƒé™
2. ä¿®å¤äº†logsç›®å½•æƒé™
3. åˆ›å»ºäº†æƒé™ä¿®å¤è„šæœ¬
4. éªŒè¯äº†ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

### ğŸ¯ **åç»­å»ºè®®**
1. åœ¨æ¯æ¬¡éƒ¨ç½²æ—¶è¿è¡Œæƒé™ä¿®å¤è„šæœ¬
2. å®šæœŸæ£€æŸ¥æƒé™è®¾ç½®
3. ç›‘æ§ä¸Šä¼ æ¥å£çš„å¯ç”¨æ€§
4. å»ºç«‹æƒé™å˜æ›´çš„å®¡æ ¸æµç¨‹

**ä¿®å¤æ—¶é—´**: 2025-08-01
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
**éªŒè¯çŠ¶æ€**: âœ… å·²é€šè¿‡æµ‹è¯• 