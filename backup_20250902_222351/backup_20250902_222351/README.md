# 企业官网与后台管理系统需求分析与技术方案

## 一、项目需求

本项目为企业官网，包含以下主要功能：

### 数据库表结构设计

#### 1. 公司基础信息表（company_info）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| name | VARCHAR(255) | 公司名称 |
| logo_url | VARCHAR(255) | Logo图片路径 |
| email | VARCHAR(255) | 公司邮箱 |
| phone | VARCHAR(50) | 公司电话 |
| address | VARCHAR(500) | 公司地址 |
| working_hours | VARCHAR(200) | 工作时间 |
| company_image | VARCHAR(255) | 公司图片路径 |
| main_business | TEXT | 主营业务简介（文本） |
| main_pic_url | VARCHAR(255) | 主营业务配图路径 |
| about_text | TEXT | 公司介绍（About页面） |

#### 2. 轮播图表（carousel_images）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| image_url | VARCHAR(255) | 轮播图片路径 |
| caption | VARCHAR(255) | 图片上的简短文字介绍 |
| description | TEXT | 图片详细介绍（可选） |
| sort_order | INT | 显示顺序 |
| is_active | TINYINT(1) | 是否启用（1/0） |

#### 3. 联系我们字段表（contact_fields）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| field_name | VARCHAR(50) | 字段名，如name、email |
| field_label | VARCHAR(50) | 字段显示名称，如"姓名" |
| field_type | VARCHAR(20) | 类型（text, email等） |
| is_required | TINYINT(1) | 是否必填（1/0） |
| sort_order | INT | 显示顺序 |

#### 4. 联系我们提交表（contact_messages）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| user_id | INT | 用户ID（可选，关联用户表） |
| name | VARCHAR(100) | 联系人姓名 |
| email | VARCHAR(100) | 联系人邮箱 |
| phone | VARCHAR(50) | 联系人电话 |
| subject | VARCHAR(200) | 咨询主题 |
| message | TEXT | 留言内容 |
| created_at | DATETIME | 提交时间 |

#### 5. 主营业务表（services）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| name | VARCHAR(255) | 业务名称 |
| description | TEXT | 业务简介 |
| image_url | VARCHAR(255) | 配图路径 |
| sort_order | INT | 显示顺序 |
| is_active | TINYINT(1) | 是否显示（1/0） |

#### 6. 用户表（users）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| username | VARCHAR(50) | 用户名/昵称（可选） |
| password_hash | VARCHAR(255) | 密码Hash（如果有密码则存储） |
| email | VARCHAR(100) | 邮箱（可选） |
| phone | VARCHAR(50) | 手机号（可选，便于手机号注册登录） |
| role | VARCHAR(20) | 用户角色 |
| wx_openid | VARCHAR(50) | 微信OpenID（小程序用户唯一标识） |
| wx_unionid | VARCHAR(50) | 微信UnionID（同一微信账号下唯一） |
| app_openid | VARCHAR(50) | App端第三方登录openid（可选） |
| avatar_url | VARCHAR(255) | 头像地址 |
| status | TINYINT(1) | 状态（启用/禁用） |
| created_at | DATETIME | 注册时间 |
| updated_at | DATETIME | 更新时间 |

**角色说明**：
- `admin`：管理员，可以登录后台管理系统
- `customer`：普通用户/客户，可以登录前台，进行询价和咨询
- `wx_user`：微信小程序用户，通过微信登录
- `app_user`：App端用户，通过第三方登录

**多端支持**：
- **管理员登录**：使用用户名+密码登录后台管理系统
- **客户端用户**：支持注册登录，通过询价和咨询功能与企业互动
- **微信小程序**：通过微信OpenID自动注册和登录
- **App端**：通过第三方OpenID自动注册和登录

#### 7. 询价表（inquiries）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键，自增 |
| user_id | INT | 用户ID（可选，关联用户表） |
| product_id | INT | 产品ID |
| product_name | VARCHAR(255) | 产品名称 |
| product_model | VARCHAR(100) | 产品型号 |
| product_image | VARCHAR(255) | 产品图片 |
| name | VARCHAR(100) | 询价人姓名 |
| email | VARCHAR(100) | 询价人邮箱 |
| phone | VARCHAR(50) | 询价人电话 |
| content | TEXT | 询价内容 |
| created_at | DATETIME | 询价时间 |

### 功能模块

- **企业基础信息管理**：在后台管理系统中可以修改公司基础信息。
- **轮播图管理**：在后台管理系统中新增轮播图模块，可以增删查改，客户端前台可以查询显示。
- **联系我们字段管理**：在后台管理系统中新增联系我们字段模块，可以增删查改。
- **联系我们提交管理**：与现有询盘列表做比较，查漏补缺。
- **主营业务管理**：在后台管理系统中新增主营业务模块，可以增删查改，客户端前台可以查询显示。
- **产品展示**：
  - 支持按大类选择小类，按小类展示商品。
  - 商品详情页包含图片、标题、型号、简要介绍、详情介绍、询价按钮。
  - 询价功能：填写邮箱和询价信息，提交后企业负责人收到邮件。
- **后台管理**：
  - 登录后可修改企业基础信息、轮播图、联系我们字段、主营业务等。
  - 支持产品分类、商品的增删改查。
  - 可查看收到的商品询价和联系我们提交。
  - **用户管理**：支持用户注册、登录、修改密码、角色管理。
  - **权限控制**：通过角色字段区分管理员和普通用户，管理员可登录后台，普通用户只能操作前台功能。
  - **多端用户支持**：支持管理员、客户端、微信小程序、App端用户的统一管理。
  - **Token刷新机制**：自动处理401授权过期问题，延长token有效期至24小时。

### 客户端用户登录与询价功能

#### 1. 登录弹窗功能
- **登录组件封装**：将登录页面的核心内容（表单部分）封装为可复用的组件
- **弹窗显示**：在需要登录的场景下弹出登录弹窗
- **响应式设计**：弹窗适配不同设备尺寸
- **用户体验**：弹窗关闭后返回原页面状态

#### 2. 用户注册流程
- **注册表单**：用户名、密码、确认密码、邮箱、手机号
- **表单验证**：前端验证必填字段、密码强度、邮箱格式等
- **注册成功**：注册成功后自动跳转到个人中心页面
- **头像上传**：在个人中心页面提供头像上传功能
- **用户信息完善**：支持修改个人信息、上传头像等

#### 3. 用户登录流程
- **登录验证**：验证用户名/邮箱/手机号和密码
- **登录成功**：获取用户信息，包括邮箱、手机号等
- **自动填充**：登录后自动将用户信息填充到询价表单
- **状态保持**：登录状态在浏览器中保持

#### 4. 询价功能增强
- **登录检查**：点击询价时检查用户登录状态
- **未登录处理**：未登录时弹出登录弹窗
- **已登录处理**：已登录时直接打开询价弹窗，自动填充用户信息
- **询价记录**：提交询价后在用户中心显示询价记录
- **产品关联**：询价记录包含产品ID、产品名称、产品型号、产品图片

#### 5. 用户中心功能
- **个人信息管理**：修改用户名、邮箱、手机号、头像等
- **询价列表**：显示用户的所有询价记录
- **咨询列表**：显示用户的所有咨询记录
- **记录详情**：查看询价和咨询的详细信息

#### 6. 咨询功能增强
- **联系我们页面**：支持在线咨询功能
- **用户信息自动填充**：已登录用户自动填充邮箱和手机号
- **未登录用户**：未登录用户可以直接提交咨询信息
- **咨询记录**：提交咨询后在用户中心显示咨询记录

#### 7. 用户头像下拉菜单
- **用户信息显示**：显示用户名和头像
- **下拉菜单项**：
  - 个人中心
  - 询价列表
  - 咨询列表
  - 退出登录

### 用户管理系统优化

#### 1. 401授权过期问题解决方案
- **Token有效期延长**：从60分钟延长到1440分钟（24小时）
- **自动刷新机制**：前端自动检测401错误并尝试刷新token
- **无缝用户体验**：用户无需手动重新登录，系统自动处理token过期
- **错误处理优化**：刷新失败时自动跳转到登录页面

#### 2. 多端用户支持
- **统一用户表**：所有端用户使用同一个users表，便于统一管理
- **多种登录方式**：
  - 管理员：用户名+密码登录
  - 客户端用户：用户名/邮箱/手机号+密码登录
  - 微信小程序：微信OpenID自动登录
  - App端：第三方OpenID自动登录
- **角色权限管理**：支持admin、customer、wx_user、app_user四种角色
- **用户状态管理**：支持启用/禁用用户状态

#### 3. 用户管理功能
- **用户列表展示**：显示所有用户信息，包括OpenID、头像等
- **用户筛选**：支持按角色、状态筛选用户
- **用户编辑**：支持修改用户基本信息、角色、状态等
- **密码管理**：管理员可重置用户密码
- **用户删除**：支持删除用户（谨慎操作）

#### 4. 数据库优化
- **索引优化**：为wx_openid、app_openid、role、status字段创建索引
- **字段扩展**：添加微信和App相关字段，支持多端用户
- **数据完整性**：确保OpenID唯一性，防止重复绑定

---

## 前端客户展示网站需求

### 1. 网站菜单结构
- **首页**：展示公司主营业务
- **分类**：显示产品分类导航
- **关于**：展示公司背景、工厂介绍、地址、邮箱等信息
- **联系我们**：展示联系方式，提供咨询功能
- **用户中心**：用户登录后的个人中心（询价列表、咨询列表、个人信息）

### 2. 页面功能详细说明

#### 2.1 首页（Home）
- **公司主营业务展示**：从后台管理系统获取并展示公司的主营业务信息
- **现代化设计**：参考提供的设计图片，采用专业的蓝色主题配色
- **响应式布局**：适配不同设备尺寸
- **公司Logo展示**：在页面顶部显示公司Logo
- **联系信息**：显示邮箱、电话等联系方式

#### 2.2 分类页面（Categories）
- **大类目展示**：显示所有顶级分类（parent_id为null的分类）
- **分类导航**：点击大类目跳转到对应的子类目页面
- **分类图片**：显示分类的图片（如果有）
- **分类描述**：显示分类的简要描述

#### 2.3 子类目页面（SubCategories）
- **子类目产品列表**：显示该子类目下的所有产品
- **产品卡片展示**：每个产品显示主图、标题、型号、简要介绍
- **产品搜索**：支持按产品名称、型号搜索
- **分页功能**：支持产品列表分页显示
- **返回上级**：提供返回大类目的导航

#### 2.4 产品详情页（ProductDetail）
- **产品信息展示**：
  - 产品标题
  - 产品型号
  - 产品图片（支持多图轮播）
  - 简要介绍（富文本显示）
  - 详情介绍（富文本显示）
- **询价功能**：
  - 在产品信息侧边显示询价按钮
  - 点击询价按钮检查用户登录状态
  - 未登录时弹出登录弹窗
  - 已登录时弹出询价表单，自动填充用户信息
  - 询价表单包含：用户姓名、邮箱、手机号、询价内容
  - 提交询价时自动包含产品ID、产品标题、产品型号、产品图片信息
  - 询价成功后发送邮件到公司邮箱
  - 在后台管理系统添加询价记录
  - 在用户中心添加询价记录
- **响应式设计**：适配移动端和桌面端

#### 2.5 关于页面（About）
- **公司背景**：展示公司背景介绍
- **工厂介绍**：展示工厂相关信息
- **公司地址**：显示公司详细地址
- **联系方式**：显示邮箱、电话等联系信息
- **公司Logo**：展示公司Logo

#### 2.6 联系我们页面（Contact）
- **联系信息展示**：公司地址、邮箱、电话
- **咨询功能**：提供在线咨询表单
- **用户信息自动填充**：已登录用户自动填充邮箱和手机号
- **未登录用户支持**：未登录用户可以直接提交咨询信息
- **咨询记录**：提交咨询后在用户中心显示咨询记录
- **地图展示**：可集成地图显示公司位置

#### 2.7 用户中心页面（Profile）
- **个人信息管理**：
  - 修改用户名、邮箱、手机号
  - 上传和修改头像
  - 修改密码
- **询价列表**：
  - 显示用户的所有询价记录
  - 包含产品信息（产品名称、型号、图片）
  - 显示询价内容、提交时间等
- **咨询列表**：
  - 显示用户的所有咨询记录
  - 包含咨询主题、内容、提交时间等
- **记录详情**：查看询价和咨询的详细信息

### 3. 登录注册功能详细说明

#### 3.1 登录弹窗组件
- **组件封装**：将登录表单封装为可复用的弹窗组件
- **弹窗样式**：现代化设计，与网站整体风格一致
- **表单字段**：
  - 用户名/邮箱/手机号
  - 密码
  - 记住登录状态（可选）
- **表单验证**：前端验证必填字段
- **登录成功**：关闭弹窗，更新用户状态，自动填充询价表单

#### 3.2 注册功能
- **注册表单**：
  - 用户名（必填）
  - 密码（必填，需验证强度）
  - 确认密码（必填）
  - 邮箱（必填，需验证格式）
  - 手机号（可选）
- **表单验证**：
  - 用户名唯一性检查
  - 密码强度验证
  - 邮箱格式验证
  - 手机号格式验证
- **注册成功**：自动跳转到个人中心页面，提示上传头像

#### 3.3 用户头像下拉菜单
- **用户信息显示**：显示用户名和头像
- **下拉菜单项**：
  - 个人中心：跳转到用户中心页面
  - 询价列表：跳转到询价列表页面
  - 咨询列表：跳转到咨询列表页面
  - 退出登录：清除登录状态，跳转到首页

### 4. 询价功能详细说明

#### 4.1 询价流程
1. **点击询价按钮**：在产品列表或详情页面点击询价按钮
2. **登录状态检查**：检查用户是否已登录
3. **未登录处理**：弹出登录弹窗，用户登录后自动打开询价表单
4. **已登录处理**：直接打开询价表单，自动填充用户信息
5. **表单填写**：用户填写询价内容
6. **提交处理**：
   - 保存询价记录到数据库
   - 发送邮件到公司邮箱
   - 在用户中心添加询价记录
   - 显示成功提示

#### 4.2 询价表单字段
- **自动填充字段**（已登录用户）：
  - 用户姓名（从用户信息获取）
  - 用户邮箱（从用户信息获取）
  - 用户手机号（从用户信息获取）
- **手动填写字段**：
  - 询价内容（必填，支持多行文本）
- **自动包含信息**：
  - 产品ID
  - 产品名称
  - 产品型号
  - 产品图片

#### 4.3 询价记录管理
- **用户中心显示**：在用户中心的询价列表页面显示所有询价记录
- **记录信息**：
  - 产品信息（名称、型号、图片）
  - 询价内容
  - 提交时间
  - 处理状态（可选）

### 5. 咨询功能详细说明

#### 5.1 咨询流程
1. **联系我们页面**：用户访问联系我们页面
2. **表单显示**：显示咨询表单
3. **信息自动填充**：已登录用户自动填充邮箱和手机号
4. **表单填写**：用户填写咨询主题和内容
5. **提交处理**：
   - 保存咨询记录到数据库
   - 发送邮件到公司邮箱
   - 在用户中心添加咨询记录（如果用户已登录）
   - 显示成功提示

#### 5.2 咨询表单字段
- **自动填充字段**（已登录用户）：
  - 用户邮箱（从用户信息获取）
  - 用户手机号（从用户信息获取）
- **手动填写字段**：
  - 姓名（必填）
  - 咨询主题（必填）
  - 咨询内容（必填，支持多行文本）

#### 5.3 咨询记录管理
- **用户中心显示**：在用户中心的咨询列表页面显示所有咨询记录
- **记录信息**：
  - 咨询主题
  - 咨询内容
  - 提交时间
  - 处理状态（可选）

### 6. 技术实现要求

#### 6.1 前端技术栈
- **Vue 3**：使用Composition API
- **Vue Router**：路由管理
- **Axios**：HTTP请求
- **Vuex/Pinia**：状态管理
- **响应式设计**：使用CSS Grid和Flexbox
- **现代化UI**：参考提供的设计图片样式

#### 6.2 页面路由结构
```
/                    # 首页
/categories          # 分类页面
/categories/:id      # 子类目页面
/product/:id         # 产品详情页
/about               # 关于页面
/contact             # 联系我们页面
/login               # 登录页面
/register            # 注册页面
/profile             # 用户中心页面
/inquiries           # 询价列表页面
/consultations       # 咨询列表页面
```

#### 6.3 API接口需求
- `GET /api/company/` - 获取公司信息
- `GET /api/category/` - 获取所有分类
- `GET /api/category/{id}/products` - 获取分类下的产品
- `GET /api/product/{id}` - 获取产品详情
- `POST /api/inquiry/` - 提交询价
- `POST /api/contact-message/` - 提交咨询
- `POST /api/user/register` - 用户注册
- `POST /api/user/login` - 用户登录
- `GET /api/user/profile` - 获取用户信息
- `PUT /api/user/profile` - 更新用户信息
- `GET /api/user/inquiries` - 获取用户询价列表
- `GET /api/user/consultations` - 获取用户咨询列表

### 7. 设计参考
- **配色方案**：蓝色主题（#1e40af, #3b82f6, #60a5fa）
- **布局风格**：现代化、专业、简洁
- **字体**：使用系统默认字体，确保可读性
- **图片处理**：支持图片懒加载和优化
- **弹窗设计**：现代化弹窗设计，支持遮罩层和动画效果

---

## 产品管理功能完善说明

### 产品分类选择
- 新建和编辑产品时，分类选择采用“大类目-子类目”二级联动：
  - 先选择大类目，再选择该大类目下的子类目。
  - 只有子类目可被选为产品分类，产品不能直接挂在大类目下。

### 产品主图上传
- 每个产品最多可上传5张主图，主图为图片URL数组，至少需上传1张主图。
- 支持JPG/PNG格式，单张图片大小不超过2MB。
- 图片上传后自动存储并返回可访问的URL。

### 富文本编辑
- **简要介绍**：
  - 使用富文本编辑器，可输入文字描述、修改文字样式、插入表格等。
- **详情介绍**：
  - 使用富文本编辑器，可输入详细描述、插入多张图片、支持常用排版。

### 产品数据结构
- 产品包含：标题、型号、主图（图片URL数组）、简要介绍（富文本）、详情介绍（富文本）、分类ID（仅可为子类目ID）。

### 前端页面
- 新建/编辑产品弹窗：
  - 分类选择为二级联动（大类目-子类目）。
  - 主图上传组件，支持多图上传与预览。
  - 简要介绍和详情介绍均为富文本编辑器。
  - 表单校验：主图至少1张，分类必须为子类目。

### 后端接口
- 产品相关API支持多图片、富文本字段。
- 新建/编辑产品时，后端校验分类ID必须为子类目。
- 图片上传接口支持多图片上传，返回图片URL。

---

## 二、技术选型

- **前端**：Vue 3 + Vue Router + Element Plus + Axios + wangEditor（富文本）
- **后端**：Python FastAPI + SQLAlchemy + SQLite/MySQL/PostgreSQL
- **邮件服务**：Python `smtplib` 或 `fastapi-mail`
- **认证**：JWT 登录认证
- **部署**：前端静态资源，后端 API 服务

---

## 三、功能模块拆解

### 1. 前台网站
- 首页：企业背景、主营业务、工厂介绍、公司地址、工作时间、联系咨询按钮
- 产品中心：
  - 大类、小类筛选
  - 商品列表
  - 商品详情（图片、标题、型号、简要介绍、详情介绍、询价按钮）
  - 询价弹窗（邮箱、询价内容，提交后提示成功）
- 联系我们：邮箱、地址、工作时间、咨询按钮

### 2. 后台管理
- 登录页
- 企业信息管理（背景、主营业务、工厂介绍、地址等，支持增删查改）
- 产品分类管理（大类、小类增删改查）
- 商品管理（增删改查，图片上传）
- 询价管理（收到的询价列表）
- **后台用户管理**：注册、登录、修改密码
- **区分后台用户和前端客户**：后台用户用于管理系统登录，前端客户无需注册，仅通过询价等功能与企业互动。

---

## 四、项目结构建议

### 1. 前端（Vue）

```
enterprise-frontend/
├── src/
│   ├── api/           # 封装 axios 请求
│   ├── components/    # 公共组件
│   ├── views/         # 页面视图
│   ├── router/        # 路由配置
│   ├── store/         # 状态管理
│   └── App.vue
├── public/
└── package.json
```

### 2. 后端（FastAPI）

```
enterprise-backend/
├── app/
│   ├── main.py
│   ├── models.py
│   ├── schemas.py
│   ├── crud.py
│   ├── database.py
│   ├── api/
│   │   ├── __init__.py
│   │   ├── endpoints/
│   │   │   ├── company.py
│   │   │   ├── category.py
│   │   │   ├── product.py
│   │   │   ├── inquiry.py
│   │   │   ├── user.py
│   │   │   └── upload.py
│   ├── core/
│   │   ├── security.py
│   │   └── config.py
│   └── utils/
│       └── email.py
├── uploads/          # 图片上传目录
└── requirements.txt
```

---

## 五、开发路线

### 1. 后端开发

1. **建表设计**（企业信息、产品大类、小类、商品、询价、用户）
2. **API接口**（RESTful风格，CRUD接口，JWT认证，邮件发送）
3. **后台管理接口**（企业信息、分类、商品、询价管理）
4. **公司信息支持增删查改**
5. **文件上传功能**（图片上传、存储、URL生成）
6. **后台用户支持修改密码**
7. **区分后台用户和前端客户**

### 2. 前端开发

1. **页面搭建**（首页、产品中心、商品详情、联系我们、后台管理页面）
2. **API对接**（axios 封装，接口联调）
3. **后台管理页面**（登录、企业信息、分类、商品、询价管理、用户密码修改）

---

## 六、数据库表设计（简化版）

- `company_info`：公司中文名称、英文名称、logo、企业背景、主营业务、工厂介绍、地址、邮箱、工作时间、公司图片等
- `category`：大类、小类（parent_id 实现多级分类）
- `product`：商品（图片、标题、型号、简要介绍、详情介绍、分类id）
- `inquiry`：询价（商品id、邮箱、内容、时间）
- `admin_user`：后台用户（用户名、密码hash）

---

## 七、分类管理规则

### 分类层级管理
- **顶级分类**：`parent_id` 为 `null` 的分类
- **子分类**：`parent_id` 指向其他分类ID的分类
- **分类字段**：`name`（名称）、`parent_id`（父级分类）、`image`（图片）、`sort_order`（排序）

### 分类操作限制
1. **编辑分类限制**：
   - 如果分类下有子分类，只能修改：名称、排序、图片
   - 如果分类下有子分类，不能修改父级分类
   - 如果分类下无子分类，可以自由修改所有字段

2. **删除分类限制**：
   - 如果分类下有子分类，不能删除该分类
   - 必须先删除所有子分类，才能删除父级分类

3. **用户界面提示**：
   - 编辑有子分类的分类时，父级分类下拉框自动禁用
   - 显示警告提示："此分类下有子分类，不能修改父级分类"
   - 删除有子分类的分类时，显示错误提示："该分类下有子分类，请先删除子分类"

## 八、主要API接口（补充）

### 公司信息
- `GET /api/company/` 获取公司信息（含公司中文名、英文名、logo等）
- `POST /api/company/` 新建公司信息（仅允许存在一条）
- `PUT /api/company/` 更新公司信息
- `DELETE /api/company/` 删除公司信息

### 文件上传
- `POST /api/upload/` 上传图片文件（支持JPG/PNG格式，大小限制2MB）
- `GET /uploads/{filename}` 获取上传的图片文件

### 后台用户
- `POST /api/user/register` 注册后台用户
- `POST /api/user/login` 登录后台用户，返回JWT
- `POST /api/user/change-password` 修改后台用户密码

### 区分后台用户和前端客户
- 后台用户（admin_user）表用于后台管理登录
- 前端客户无需注册，仅通过询价等功能与企业互动

---

## 八、项目初始化命令参考

### 1. 后端 FastAPI 初始化

```bash
mkdir enterprise-backend && cd enterprise-backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. 前端 Vue 初始化

```bash
npm create vue@latest enterprise-frontend
cd enterprise-frontend
npm install
npm install axios element-plus
```

---

## 九、后续开发建议

- 先完成后端数据库和API接口开发
- 再进行前端页面开发与接口联调
- 可根据实际需求扩展功能，如多语言、权限细分、数据统计等

---

## 十一、最新功能更新

### 公司信息管理功能增强

#### 新增字段
- **公司地址** (`address`): VARCHAR(500) - 支持设置公司详细地址信息
- **工作时间** (`working_hours`): VARCHAR(200) - 支持设置公司工作时间，如"周一至周五 9:00-18:00"
- **公司图片** (`company_image`): VARCHAR(255) - 支持上传公司展示图片，用于首页或关于页面展示

#### 功能特点
- **图片上传支持**：公司图片字段支持JPG/PNG格式，大小限制2MB
- **数据完整性**：所有新字段都支持在后台管理系统中查看和编辑
- **前端展示**：新字段将在前台网站的相关页面中展示
- **数据库兼容**：通过迁移脚本安全添加新字段，不影响现有数据

#### 使用场景
- **首页展示**：公司图片可用于首页的公司介绍区域
- **关于页面**：公司图片用于主营业务板块右侧展示，公司地址和工作时间在联系信息中展示
- **联系我们**：地址和工作时间信息在联系页面中显示
- **页脚信息**：地址和工作时间可在网站页脚中展示

#### 最新页面修改
- **关于页面**：
  - 公司介绍板块右侧图片使用后台管理系统中上传的公司图片（company_image）
  - 主营业务板块右侧图片使用后台管理系统中上传的主营业务配图（main_pic_url）
  - 删除了工厂介绍板块（包括文字和右侧图片）
  - 工作时间显示使用后台管理系统中设置的工作时间
- **联系我们页面**：
  - 联系信息中的工作时间使用后台管理系统中设置的工作时间
  - **分类导航功能**：
    - 顶部导航栏的"分类"菜单支持点击展开下拉菜单
    - 点击"分类"文字可以切换下拉菜单的显示/隐藏
    - 下拉菜单显示所有顶级分类（parent_id为null的分类）
    - 点击顶级分类可以展开/收起该分类的子分类菜单
    - 子分类菜单采用绝对定位，确保可以正常点击
      - 点击子分类直接跳转到该子分类的产品列表页面
  - 点击"查看所有分类"跳转到分类总览页面
  - **产品图片显示功能**：
    - 产品列表页面显示产品首图
    - 产品详情页面默认显示首图，支持多图切换
    - 图片URL自动转换为完整路径，支持相对路径和绝对路径
    - 图片加载失败时显示占位符
  - **产品询价功能**：
    - 产品列表和详情页面都支持询价功能
    - 询价表单包含姓名、邮箱、询价内容
    - 询价数据正确提交到后端API
    - 支持产品关联的询价记录
- **分类页面功能**：
  - 支持搜索功能，可以搜索分类名称和描述
  - 当有搜索关键词时，显示产品搜索结果而不是分类列表
  - 产品搜索结果支持按产品名称和型号搜索
  - 每个产品卡片显示询价和查看详情按钮
- **子分类页面功能**：
  - 显示特定子分类下的所有产品
  - 支持产品搜索和排序功能
  - 产品列表支持分页显示
  - 每个产品卡片包含询价弹窗功能
- **产品详情页面功能**：
  - 完整显示产品的所有信息（名称、型号、图片、简介、详情等）
  - 支持多图片轮播显示
  - 右侧提供询价按钮和联系我们按钮
  - 询价弹窗包含产品信息预览和表单提交功能

---

如需详细代码实现，请参考项目内各模块说明或联系开发者。 

---

## 十、管理后台前端开发方案与代码结构

### 1. 管理后台前端结构建议

```
enterprise-frontend/
├── src/
│   ├── api/           # axios 封装及各模块接口
│   ├── views/
│   │   ├── Login.vue
│   │   ├── Dashboard.vue
│   │   ├── CompanyInfo.vue
│   │   ├── CategoryManage.vue
│   │   ├── ProductManage.vue
│   │   ├── InquiryManage.vue
│   │   └── UserProfile.vue
│   ├── router/        # 路由配置
│   ├── store/         # 用户/权限/全局状态
│   └── App.vue
└── package.json
```

---

### 2. 主要页面与功能

#### 2.1 登录页（Login.vue）
- 表单：用户名、密码
- 登录成功后存储JWT，跳转后台首页

#### 2.2 首页/仪表盘（Dashboard.vue）
- 简要展示公司信息、产品/询价统计等

#### 2.3 公司信息管理（CompanyInfo.vue）
- **公司信息只保留一条记录**：系统设计为单条公司信息记录，创建新记录时会覆盖旧记录
- **创建成功后跳转到查看页面**：保存成功后自动切换到查看模式，显示公司信息详情
- **添加修改按钮**：在查看模式下提供"修改信息"按钮，点击后进入编辑模式
- **Logo字段支持图片上传**：集成Element Plus上传组件，支持JPG/PNG格式，大小限制2MB
- **公司图片字段支持图片上传**：支持上传公司展示图片，用于首页或关于页面展示
- **公司地址字段**：支持设置公司详细地址信息
- **工作时间字段**：支持设置公司工作时间，如"周一至周五 9:00-18:00"
- **图片存储和链接转换**：图片上传到后端uploads目录，自动生成唯一文件名，返回可访问的URL链接
- 展示、编辑公司信息（支持增、查、改、删）

#### 2.4 分类管理（CategoryManage.vue）
- 分类列表（大类/小类，支持树形结构）
- 新增、编辑、删除分类

#### 2.5 产品管理（ProductManage.vue）
- 产品列表（分页）
- 新增、编辑、删除产品
- 支持图片上传
- **产品搜索功能**：
  - 支持按产品标题搜索
  - 支持按产品ID搜索
  - 支持按产品型号搜索
  - 支持按产品子分类筛选
  - 搜索条件支持组合使用
- **产品复制功能**：
  - 在产品操作列添加"复制"按钮
  - 点击复制按钮可复制现有产品创建新产品
  - 复制后的产品ID为新ID，其他信息与原产品相同
  - 复制成功后刷新产品列表，不打开编辑弹窗
- **产品时间管理**：
  - 新增产品时自动设置创建时间和修改时间
  - 复制产品时自动设置创建时间和修改时间
  - 修改产品时自动更新修改时间
  - 产品列表按修改时间降序排列（最新修改的在前）
- **产品列表优化**：
  - 产品列表支持滚动条，可查看所有产品记录
  - 优化列表显示效果，提升用户体验
  - **产品分页功能**：
    - 每页显示10条产品记录
    - 支持左右翻页按钮
    - 支持输入页码跳转到指定页
    - 显示当前页码和总页数信息
    - 分页与搜索功能结合使用

#### 2.6 询价管理（InquiryManage.vue）
- 询价列表（分页）
- 查看询价详情

#### 2.7 用户资料/密码修改（UserProfile.vue）
- 修改后台用户密码

---

### 3. API 封装建议（src/api/）

- company.js：公司信息相关API
- category.js：分类相关API
- product.js：产品相关API
- inquiry.js：询价相关API
- user.js：用户注册、登录、修改密码API
- axios.js：axios实例，自动携带JWT

---

### 4. 路由与权限

- 登录后进入后台主界面，未登录跳转登录页
- JWT存储于localStorage/SessionStorage
- axios请求自动加Authorization头

---

### 5. 代码示例（部分）

#### 5.1 axios 封装（src/api/axios.js）

```js
import axios from 'axios';

const instance = axios.create({
  baseURL: 'http://localhost:8000/api', // 后端API地址
  timeout: 10000,
});

instance.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

export default instance;
```

#### 5.2 登录API（src/api/user.js）

```js
import axios from './axios';

export function login(username, password) {
  const data = new URLSearchParams();
  data.append('username', username);
  data.append('password', password);
  return axios.post('/user/login', data);
}

export function changePassword(username, oldPassword, newPassword) {
  return axios.post('/user/change-password', { username, old_password: oldPassword, new_password: newPassword });
}
```

#### 5.3 公司信息API（src/api/company.js）

```js
import axios from './axios';

export function getCompanyInfo() {
  return axios.get('/company/');
}

export function createCompanyInfo(data) {
  return axios.post('/company/', data);
}

export function updateCompanyInfo(data) {
  return axios.put('/company/', data);
}

export function deleteCompanyInfo() {
  return axios.delete('/company/');
}
```

#### 5.4 分类API（src/api/category.js）

```js
import axios from './axios';

export function getCategories() {
  return axios.get('/category/');
}

export function createCategory(data) {
  return axios.post('/category/', data);
}

export function updateCategory(id, data) {
  return axios.put(`/category/${id}`, data);
}

export function deleteCategory(id) {
  return axios.delete(`/category/${id}`);
}
```

#### 5.5 产品API（src/api/product.js）

```js
import axios from './axios';

export function getProducts(params) {
  return axios.get('/product/', { params });
}

export function createProduct(data) {
  return axios.post('/product/', data);
}

export function updateProduct(id, data) {
  return axios.put(`/product/${id}`, data);
}

export function deleteProduct(id) {
  return axios.delete(`/product/${id}`);
}

export function copyProduct(id) {
  return axios.post(`/product/${id}/copy`);
}
```

#### 5.6 询价API（src/api/inquiry.js）

```js
import axios from './axios';

export function getInquiries(params) {
  return axios.get('/inquiry/', { params });
}

export function getInquiry(id) {
  return axios.get(`/inquiry/${id}`);
}
```

---

### 6. 页面开发建议

- 每个管理页面（如CompanyInfo.vue、CategoryManage.vue等）用Element Plus的表单、表格、弹窗等组件实现CRUD。
- 登录后跳转后台首页，未登录自动跳转登录页。
- 所有API请求失败时，弹窗提示错误信息。

---

### 7. 初始化命令

```bash
npm create vue@latest enterprise-frontend
cd enterprise-frontend
npm install
npm install axios element-plus
```

---

如需具体页面（如CompanyInfo.vue、CategoryManage.vue等）代码模板或完整前端目录结构，请告知你需要的页面或功能模块，我可以为你生成详细代码！ 