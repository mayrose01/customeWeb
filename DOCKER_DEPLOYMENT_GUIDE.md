# Docker éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ä½¿ç”¨Dockerè¿›è¡Œä¼ä¸šå®˜ç½‘é¡¹ç›®çš„éƒ¨ç½²ï¼Œæ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä¸‰ä¸ªç¯å¢ƒçš„ç»Ÿä¸€ç®¡ç†ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç»Ÿä¸€Dockerfile
- **åç«¯**: `enterprise-backend/Dockerfile` - é€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒ
- **å‰ç«¯**: `enterprise-frontend/Dockerfile` - é€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒ

### åˆ†å±‚Composeé…ç½®
- **åŸºç¡€é…ç½®**: `docker-compose.yml` - å®šä¹‰æ‰€æœ‰ç¯å¢ƒå…±æœ‰çš„æœåŠ¡ç»“æ„
- **å¼€å‘ç¯å¢ƒ**: `docker-compose.dev.yml` - å¼€å‘ç¯å¢ƒè¦†ç›–é…ç½®
- **æµ‹è¯•ç¯å¢ƒ**: `docker-compose.test.yml` - æµ‹è¯•ç¯å¢ƒè¦†ç›–é…ç½®
- **ç”Ÿäº§ç¯å¢ƒ**: `docker-compose.prod.yml` - ç”Ÿäº§ç¯å¢ƒè¦†ç›–é…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå˜é‡è®¾ç½®

```bash
# è®¾ç½®å¼€å‘ç¯å¢ƒå˜é‡
source ./set_env.sh dev

# è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
source ./set_env.sh test

# è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦å…ˆè®¾ç½®PROD_*å˜é‡ï¼‰
export PROD_DATABASE_URL="mysql+pymysql://user:password@host:port/database"
export PROD_SECRET_KEY="your-production-secret-key"
source ./set_env.sh prod
```

### 2. éƒ¨ç½²æ“ä½œ

```bash
# å¼€å‘ç¯å¢ƒ
./deploy.sh dev up        # å¯åŠ¨å¼€å‘ç¯å¢ƒ
./deploy.sh dev build     # æ„å»ºå¼€å‘ç¯å¢ƒé•œåƒ
./deploy.sh dev logs      # æŸ¥çœ‹å¼€å‘ç¯å¢ƒæ—¥å¿—

# æµ‹è¯•ç¯å¢ƒ
./deploy.sh test up       # å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
./deploy.sh test build    # æ„å»ºæµ‹è¯•ç¯å¢ƒé•œåƒ
./deploy.sh test status   # æŸ¥çœ‹æµ‹è¯•ç¯å¢ƒçŠ¶æ€

# ç”Ÿäº§ç¯å¢ƒ
./deploy.sh prod up       # å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
./deploy.sh prod build    # æ„å»ºç”Ÿäº§ç¯å¢ƒé•œåƒ
./deploy.sh prod restart  # é‡å¯ç”Ÿäº§ç¯å¢ƒ
```

## ğŸ”§ ç¯å¢ƒé…ç½®è¯¦è§£

### å¼€å‘ç¯å¢ƒ (dev)
- **ç«¯å£æ˜ å°„**: æ•°æ®åº“(3308), åç«¯(8002), å‰ç«¯(3002), Nginx(8080)
- **ä»£ç æŒ‚è½½**: æ”¯æŒçƒ­æ›´æ–°ï¼Œä»£ç ä¿®æ”¹åè‡ªåŠ¨ç”Ÿæ•ˆ
- **è°ƒè¯•æ¨¡å¼**: å¯ç”¨DEBUGæ—¥å¿—çº§åˆ«
- **å•Worker**: ä¾¿äºè°ƒè¯•å’Œå¼€å‘

### æµ‹è¯•ç¯å¢ƒ (test)
- **ç«¯å£æ˜ å°„**: æ•°æ®åº“(3307), åç«¯(8001), å‰ç«¯(3001), Nginx(8080)
- **ä»£ç æŒ‚è½½**: æ”¯æŒçƒ­æ›´æ–°ï¼Œä¾¿äºæµ‹è¯•
- **æµ‹è¯•æ•°æ®**: ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
- **åŒWorker**: å¹³è¡¡æ€§èƒ½å’Œèµ„æºä½¿ç”¨

### ç”Ÿäº§ç¯å¢ƒ (prod)
- **ç«¯å£æ˜ å°„**: æ•°æ®åº“(3306), åç«¯(8000), å‰ç«¯(3000), Nginx(80/443)
- **æ— ä»£ç æŒ‚è½½**: ä½¿ç”¨æ„å»ºçš„é•œåƒï¼Œç¡®ä¿ä¸€è‡´æ€§
- **èµ„æºé™åˆ¶**: é…ç½®CPUå’Œå†…å­˜é™åˆ¶
- **å¤šWorker**: ä½¿ç”¨8ä¸ªWorkerè¿›ç¨‹ï¼Œæé«˜æ€§èƒ½
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨ç›‘æ§æœåŠ¡çŠ¶æ€

## ğŸ“¦ é•œåƒæ„å»º

### åç«¯é•œåƒç‰¹ç‚¹
- åŸºäºPython 3.11-slim
- åŒ…å«MySQLå®¢æˆ·ç«¯åº“
- érootç”¨æˆ·è¿è¡Œï¼ˆå®‰å…¨ï¼‰
- å†…ç½®å¥åº·æ£€æŸ¥
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½®Workeræ•°é‡

### å‰ç«¯é•œåƒç‰¹ç‚¹
- å¤šé˜¶æ®µæ„å»ºï¼ˆæ„å»º+ç”Ÿäº§ï¼‰
- åŸºäºNode.js 18 Alpine
- ä½¿ç”¨Nginx Alpineä½œä¸ºç”Ÿäº§æœåŠ¡å™¨
- érootç”¨æˆ·è¿è¡Œï¼ˆå®‰å…¨ï¼‰
- å†…ç½®å¥åº·æ£€æŸ¥

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å®¹å™¨å®‰å…¨
- æ‰€æœ‰æœåŠ¡ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
- æœ€å°åŒ–é•œåƒå¤§å°
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
- å¥åº·æ£€æŸ¥ç›‘æ§

### ç½‘ç»œå®‰å…¨
- è‡ªå®šä¹‰ç½‘ç»œéš”ç¦»
- å†…éƒ¨æœåŠ¡é€šä¿¡
- ç«¯å£æ˜ å°„æ§åˆ¶
- SSL/TLSæ”¯æŒ

### æ•°æ®å®‰å…¨
- æ•°æ®å·æŒä¹…åŒ–
- ç¯å¢ƒå˜é‡æ³¨å…¥æ•æ„Ÿä¿¡æ¯
- ä¸åŒ…å«ç¡¬ç¼–ç å¯†ç 
- ç”Ÿäº§ç¯å¢ƒèµ„æºé™åˆ¶

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./deploy.sh [env] status

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./deploy.sh [env] logs
```

### æ—¥å¿—ç®¡ç†
- åç«¯æ—¥å¿—: `backend_logs` æ•°æ®å·
- Nginxæ—¥å¿—: `nginx_logs` æ•°æ®å·
- æ•°æ®åº“æ—¥å¿—: å®¹å™¨å†…éƒ¨æ—¥å¿—

## ğŸ”„ éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡
source ./set_env.sh dev

# 2. å¯åŠ¨æœåŠ¡
./deploy.sh dev up

# 3. æŸ¥çœ‹çŠ¶æ€
./deploy.sh dev status
```

### æµ‹è¯•ç¯å¢ƒéƒ¨ç½²
```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡
source ./set_env.sh test

# 2. æ„å»ºé•œåƒ
./deploy.sh test build

# 3. å¯åŠ¨æœåŠ¡
./deploy.sh test up

# 4. è¿è¡Œæµ‹è¯•
# æµ‹è¯•å®Œæˆååœæ­¢æœåŠ¡
./deploy.sh test down
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# 1. è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
export PROD_DATABASE_URL="mysql+pymysql://user:password@host:port/database"
export PROD_SECRET_KEY="your-production-secret-key"
export PROD_MYSQL_ROOT_PASSWORD="your-mysql-root-password"
export PROD_MYSQL_PASSWORD="your-mysql-password"
export PROD_VITE_API_BASE_URL="https://yourdomain.com/api"

# 2. è®¾ç½®ç¯å¢ƒå˜é‡
source ./set_env.sh prod

# 3. æ„å»ºç”Ÿäº§é•œåƒ
./deploy.sh prod build

# 4. å¯åŠ¨ç”Ÿäº§æœåŠ¡ï¼ˆè‡ªåŠ¨è¿è¡Œæ•°æ®åº“è¿ç§»ï¼‰
./deploy.sh prod up

# 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€
./deploy.sh prod status

# 6. æ£€æŸ¥æ•°æ®åº“è¿ç§»çŠ¶æ€
./deploy.sh prod migrate-check
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
./check_environment_config.sh

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./deploy.sh [env] logs
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.yml -f docker-compose.[env].yml ps mysql

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose -f docker-compose.yml -f docker-compose.[env].yml logs mysql
```

#### 3. å‰ç«¯æ— æ³•è®¿é—®åç«¯
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
docker network inspect enterprise_enterprise_network

# æ£€æŸ¥æœåŠ¡é—´é€šä¿¡
docker exec -it enterprise_backend_[env] curl http://mysql:3306
```

### æ¸…ç†æ“ä½œ
```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
./deploy.sh [env] down

# åˆ é™¤é•œåƒ
docker rmi enterprise-backend_backend enterprise-frontend_frontend

# æ¸…ç†æ•°æ®å·ï¼ˆè°¨æ…æ“ä½œï¼‰
docker volume prune
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
- ä½¿ç”¨å¤šWorkerè¿›ç¨‹
- é…ç½®èµ„æºé™åˆ¶
- å¯ç”¨å¥åº·æ£€æŸ¥
- ä½¿ç”¨æ•°æ®å·æŒä¹…åŒ–

### å¼€å‘ç¯å¢ƒä¼˜åŒ–
- ä»£ç çƒ­æ›´æ–°
- å•Workerä¾¿äºè°ƒè¯•
- è¯¦ç»†æ—¥å¿—è¾“å‡º
- å¿«é€Ÿé‡å¯

## ğŸ“ æ•°æ®åº“è¿ç§»

### è‡ªåŠ¨è¿ç§»
éƒ¨ç½²è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š
1. å¯åŠ¨æ•°æ®åº“æœåŠ¡
2. ç­‰å¾…æ•°æ®åº“å°±ç»ª
3. è¿è¡Œæ•°æ®åº“è¿ç§»
4. å¯åŠ¨åº”ç”¨æœåŠ¡

### æ‰‹åŠ¨è¿ç§»
```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
./deploy.sh [env] migrate

# æ£€æŸ¥è¿ç§»çŠ¶æ€
./deploy.sh [env] migrate-check
```

### è¿ç§»ç®¡ç†
```bash
# åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
./migrate.sh [env] create "è¿ç§»æè¿°"

# æŸ¥çœ‹è¿ç§»å†å²
./migrate.sh [env] history

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
./migrate.sh [env] current
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡
1. åœ¨ `docker-compose.yml` ä¸­æ·»åŠ ç¯å¢ƒå˜é‡å®šä¹‰
2. åœ¨å¯¹åº”çš„è¦†ç›–æ–‡ä»¶ä¸­è®¾ç½®é»˜è®¤å€¼
3. åœ¨ `set_env.sh` ä¸­æ·»åŠ ç¯å¢ƒå˜é‡è®¾ç½®
4. æ›´æ–° `check_environment_config.sh` æ£€æŸ¥è„šæœ¬

### ä¿®æ”¹æœåŠ¡é…ç½®
1. åœ¨åŸºç¡€ `docker-compose.yml` ä¸­å®šä¹‰æœåŠ¡ç»“æ„
2. åœ¨ç¯å¢ƒè¦†ç›–æ–‡ä»¶ä¸­ä¿®æ”¹ç‰¹å®šé…ç½®
3. é‡æ–°æ„å»ºå’Œéƒ¨ç½²æœåŠ¡

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. æœ¬éƒ¨ç½²æŒ‡å—
2. Dockerå®˜æ–¹æ–‡æ¡£
3. é¡¹ç›®README.md
4. è”ç³»å¼€å‘å›¢é˜Ÿ
