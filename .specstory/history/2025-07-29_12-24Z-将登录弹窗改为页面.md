<!-- Generated by SpecStory -->

# 将登录弹窗改为页面 (2025-07-29 12:24Z)

_**User**_

客户端前端的登录现在是弹窗，都改成页面。还是封装起来方便要用的时候调用。注册也是要改成页面。不要弹窗的形式。

---

_**Assistant**_

我来帮您将客户端的登录和注册从弹窗形式改为页面形式，并封装成可复用的组件。首先让我查看当前的登录和注册实现。


---

Read file: enterprise-frontend/src/components/client/LoginModal.vue

---

现在让我查看当前的路由配置，了解客户端的路由结构：


---

Read file: enterprise-frontend/src/router/index.js

---

我看到路由配置中已经有客户端的登录和注册页面路由，但让我检查一下这些页面是否已经存在：


---

Read file: enterprise-frontend/src/views/client/Login.vue

---

Read file: enterprise-frontend/src/views/client/Register.vue

---

现在让我查看一下Header组件，看看是否还在使用弹窗形式的登录：


---

Read file: enterprise-frontend/src/components/client/Header.vue

---

我看到Header组件中还在使用弹窗形式的登录。现在我需要：

1. 修改Header组件，将登录和注册按钮改为路由跳转
2. 创建一个可复用的登录和注册组件
3. 确保现有的登录和注册页面正常工作

首先，让我修改Header组件，移除弹窗形式的登录：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -23,6 +23,6 @@
              <div class="user-section">
                <div v-if="!userStore.isLoggedIn" class="login-buttons">
-                 <button class="login-btn" @click="showLoginModalFunc">登录</button>
-                 <button class="register-btn" @click="showLoginModalFunc">注册</button>
+                 <router-link to="/login" class="login-btn">登录</router-link>
+                 <router-link to="/register" class="register-btn">注册</router-link>
                </div>
                <div v-else class="user-info">
```

</details>

---

现在移除Header组件中的弹窗相关代码：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 6

```diff
@@ -118,10 +118,5 @@
      </nav>
      
-     <!-- 登录弹窗 -->
-     <LoginModal 
-       :visible="showLoginModal"
-       @close="hideLoginModal"
-       @login-success="handleLoginSuccess"
-     />
+ 
    </header>
  </template>
```

</details>

---

现在移除Header组件中的弹窗相关导入和方法：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 2

```diff
@@ -123,10 +123,9 @@
  
  <script>
- import { ref, onMounted, watch, onUnmounted } from 'vue'
+ import { ref, onMounted, onUnmounted } from 'vue'
  import { useRouter } from 'vue-router'
  import { getCompanyInfo } from '@/api/client'
  import { getCategories, getSubcategories } from '@/api/category'
  import { userStore } from '@/store/user'
- import LoginModal from './LoginModal.vue'
  
  export default {
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 3

```diff
@@ -131,7 +131,5 @@
  export default {
    name: 'ClientHeader',
-   components: {
-     LoginModal
-   },
+ 
    setup() {
      const router = useRouter()
```

</details>

---

现在移除Header组件中的弹窗相关状态和方法：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -136,7 +136,4 @@
      const companyInfo = ref({})
      const searchKeyword = ref('')
-     
-     // 登录弹窗状态
-     const showLoginModal = ref(false)
      
      // 用户下拉菜单状态
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 15

```diff
@@ -155,19 +155,5 @@
      }
  
-     // 显示登录弹窗
-     const showLoginModalFunc = () => {
-       showLoginModal.value = true
-     }
- 
-     // 隐藏登录弹窗
-     const hideLoginModal = () => {
-       showLoginModal.value = false
-     }
- 
-     // 处理登录成功
-     const handleLoginSuccess = (userData) => {
-       hideLoginModal()
-       // 登录成功后的处理逻辑
-     }
+ 
  
      // 切换用户下拉菜单
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: undefined, lines removed: 4

```diff
@@ -269,13 +269,9 @@
          searchKeyword,
          userStore,
-         showLoginModal,
          isUserDropdownVisible,
          isCategoriesDropdownVisible,
          topCategories,
          subcategories,
          activeCategoryId,
-         showLoginModalFunc,
-         hideLoginModal,
-         handleLoginSuccess,
          toggleUserDropdown,
          goToProfile,
```

</details>

---

现在我需要更新Header组件的CSS样式，将按钮样式应用到router-link上：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/Header.vue</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -577,4 +577,6 @@
    cursor: pointer;
    transition: all 0.2s;
+   text-decoration: none;
+   display: inline-block;
  }
  
```

**Chunk 2**
Lines added: 2, lines removed: undefined

```diff
@@ -586,4 +588,6 @@
  .login-btn:hover {
    background-color: #2563eb;
+   color: white;
+   text-decoration: none;
  }
  
```

**Chunk 3**
Lines added: 2, lines removed: undefined

```diff
@@ -595,4 +599,6 @@
  .register-btn:hover {
    background-color: #059669;
+   color: white;
+   text-decoration: none;
  }
  
```

</details>

---

现在让我创建一个可复用的登录组件，将现有的登录逻辑封装起来：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/LoginForm.vue</summary>

创建一个可复用的登录表单组件，包含登录和注册功能

**Chunk 1**
Lines added: 380, lines removed: 1

```diff
@@ -1,1 +1,380 @@
- 
+ <template>
+   <div class="auth-form-container">
+     <div class="auth-card">
+       <div class="auth-header">
+         <h2>{{ isLogin ? '用户登录' : '用户注册' }}</h2>
+         <p>{{ isLogin ? '欢迎回到我们的企业官网' : '加入我们的企业官网，享受更多服务' }}</p>
+       </div>
+       
+       <!-- 登录表单 -->
+       <form v-if="isLogin" @submit.prevent="handleLogin" class="auth-form">
+         <div class="form-group">
+           <label for="username">用户名/邮箱/手机号</label>
+           <input
+             id="username"
+             v-model="loginForm.username"
+             type="text"
+             placeholder="请输入用户名、邮箱或手机号"
+             required
+           />
+         </div>
+         
+         <div class="form-group">
+           <label for="password">密码</label>
+           <input
+             id="password"
+             v-model="loginForm.password"
+             type="password"
+             placeholder="请输入密码"
+             required
+           />
+         </div>
+         
+         <div class="form-actions">
+           <button type="submit" class="btn-primary" :disabled="loading">
+             {{ loading ? '登录中...' : '登录' }}
+           </button>
+         </div>
+         
+         <div class="form-footer">
+           <span>还没有账号？</span>
+           <button type="button" class="link-btn" @click="switchToRegister">
+             立即注册
+           </button>
+         </div>
+       </form>
+       
+       <!-- 注册表单 -->
+       <form v-else @submit.prevent="handleRegister" class="auth-form">
+         <div class="form-group">
+           <label for="reg-username">用户名</label>
+           <input
+             id="reg-username"
+             v-model="registerForm.username"
+             type="text"
+             placeholder="请输入用户名"
+             required
+           />
+         </div>
+         
+         <div class="form-group">
+           <label for="reg-email">邮箱</label>
+           <input
+             id="reg-email"
+             v-model="registerForm.email"
+             type="email"
+             placeholder="请输入邮箱"
+             required
+           />
+         </div>
+         
+         <div class="form-group">
+           <label for="reg-phone">手机号（可选）</label>
+           <input
+             id="reg-phone"
+             v-model="registerForm.phone"
+             type="tel"
+             placeholder="请输入手机号"
+           />
+         </div>
+         
+         <div class="form-group">
+           <label for="reg-password">密码</label>
+           <input
+             id="reg-password"
+             v-model="registerForm.password"
+             type="password"
+             placeholder="请输入密码"
+             required
+           />
+         </div>
+         
+         <div class="form-group">
+           <label for="reg-confirm-password">确认密码</label>
+           <input
+             id="reg-confirm-password"
+             v-model="registerForm.confirmPassword"
+             type="password"
+             placeholder="请再次输入密码"
+             required
+           />
+         </div>
+         
+         <div class="form-actions">
+           <button type="submit" class="btn-primary" :disabled="loading">
+             {{ loading ? '注册中...' : '注册' }}
+           </button>
+         </div>
+         
+         <div class="form-footer">
+           <span>已有账号？</span>
+           <button type="button" class="link-btn" @click="switchToLogin">
+             立即登录
+           </button>
+         </div>
+       </form>
+     </div>
+   </div>
+ </template>
+ 
+ <script>
+ import { ref, reactive } from 'vue'
+ import { useRouter } from 'vue-router'
+ import { userStore } from '../../store/user'
+ import { clientLogin, clientRegister } from '../../api/user'
+ 
+ export default {
+   name: 'LoginForm',
+   props: {
+     initialMode: {
+       type: String,
+       default: 'login', // 'login' or 'register'
+       validator: (value) => ['login', 'register'].includes(value)
+     },
+     onSuccess: {
+       type: Function,
+       default: null
+     },
+     redirectTo: {
+       type: String,
+       default: '/'
+     }
+   },
+   emits: ['login-success', 'register-success'],
+   setup(props, { emit }) {
+     const router = useRouter()
+     const loading = ref(false)
+     const isLogin = ref(props.initialMode === 'login')
+     
+     const loginForm = reactive({
+       username: '',
+       password: ''
+     })
+     
+     const registerForm = reactive({
+       username: '',
+       email: '',
+       phone: '',
+       password: '',
+       confirmPassword: ''
+     })
+     
+     const switchToRegister = () => {
+       isLogin.value = false
+     }
+     
+     const switchToLogin = () => {
+       isLogin.value = true
+     }
+     
+     const handleLogin = async () => {
+       if (loading.value) return
+       
+       loading.value = true
+       try {
+         const response = await clientLogin(loginForm.username, loginForm.password)
+         const data = response.data
+         
+         localStorage.setItem('client_token', data.access_token)
+         localStorage.setItem('client_user', JSON.stringify(data.user))
+         userStore.setUserInfo(data.user)
+         
+         // 调用成功回调
+         if (props.onSuccess) {
+           props.onSuccess(data.user)
+         }
+         
+         emit('login-success', data.user)
+         
+         // 显示成功消息
+         alert('登录成功！')
+         
+         // 跳转到指定页面
+         router.push(props.redirectTo)
+       } catch (error) {
+         console.error('登录失败:', error)
+         const errorMessage = error.response?.data?.detail || '登录失败，请检查用户名和密码'
+         alert(errorMessage)
+       } finally {
+         loading.value = false
+       }
+     }
+     
+     const handleRegister = async () => {
+       if (loading.value) return
+       
+       // 验证密码
+       if (registerForm.password !== registerForm.confirmPassword) {
+         alert('两次输入的密码不一致')
+         return
+       }
+       
+       if (registerForm.password.length < 6) {
+         alert('密码长度至少6位')
+         return
+       }
+       
+       loading.value = true
+       try {
+         const response = await clientRegister({
+           username: registerForm.username,
+           email: registerForm.email,
+           phone: registerForm.phone || null,
+           password: registerForm.password
+         })
+         
+         emit('register-success', response.data)
+         alert('注册成功！请登录')
+         switchToLogin()
+         
+         // 清空注册表单
+         Object.keys(registerForm).forEach(key => {
+           registerForm[key] = ''
+         })
+       } catch (error) {
+         console.error('注册失败:', error)
+         const errorMessage = error.response?.data?.detail || '注册失败，请稍后重试'
+         alert(errorMessage)
+       } finally {
+         loading.value = false
+       }
+     }
+     
+     return {
+       loading,
+       isLogin,
+       loginForm,
+       registerForm,
+       switchToRegister,
+       switchToLogin,
+       handleLogin,
+       handleRegister
+     }
+   }
+ }
+ </script>
+ 
+ <style scoped>
+ .auth-form-container {
+   display: flex;
+   justify-content: center;
+   align-items: center;
+   min-height: 100vh;
+   background: #f8f9fa;
+   padding: 20px;
+ }
+ 
+ .auth-card {
+   background: white;
+   border-radius: 12px;
+   box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
+   padding: 40px;
+   width: 100%;
+   max-width: 400px;
+   border: 1px solid #e9ecef;
+ }
+ 
+ .auth-header {
+   text-align: center;
+   margin-bottom: 30px;
+ }
+ 
+ .auth-header h2 {
+   color: #333;
+   margin-bottom: 10px;
+   font-size: 28px;
+   font-weight: 600;
+ }
+ 
+ .auth-header p {
+   color: #666;
+   font-size: 16px;
+ }
+ 
+ .auth-form {
+   margin-bottom: 20px;
+ }
+ 
+ .form-group {
+   margin-bottom: 20px;
+ }
+ 
+ .form-group label {
+   display: block;
+   margin-bottom: 5px;
+   color: #333;
+   font-weight: 500;
+ }
+ 
+ .form-group input {
+   width: 100%;
+   padding: 12px;
+   border: 1px solid #ddd;
+   border-radius: 4px;
+   font-size: 14px;
+   box-sizing: border-box;
+ }
+ 
+ .form-group input:focus {
+   outline: none;
+   border-color: #3b82f6;
+   box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
+ }
+ 
+ .form-actions {
+   margin-top: 30px;
+ }
+ 
+ .btn-primary {
+   width: 100%;
+   padding: 12px;
+   background-color: #3b82f6;
+   color: white;
+   border: none;
+   border-radius: 4px;
+   font-size: 16px;
+   cursor: pointer;
+   transition: background-color 0.2s;
+ }
+ 
+ .btn-primary:hover:not(:disabled) {
+   background-color: #2563eb;
+ }
+ 
+ .btn-primary:disabled {
+   background-color: #9ca3af;
+   cursor: not-allowed;
+ }
+ 
+ .form-footer {
+   margin-top: 20px;
+   text-align: center;
+   color: #666;
+ }
+ 
+ .link-btn {
+   background: none;
+   border: none;
+   color: #3b82f6;
+   cursor: pointer;
+   text-decoration: underline;
+   font-size: 14px;
+   margin-left: 5px;
+ }
+ 
+ .link-btn:hover {
+   color: #2563eb;
+ }
+ 
+ /* 响应式设计 */
+ @media (max-width: 480px) {
+   .auth-card {
+     padding: 30px 20px;
+     margin: 10px;
+   }
+   
+   .auth-header h2 {
+     font-size: 24px;
+   }
+ }
+ </style> 
```

</details>

---

现在我需要检查API文件，确保clientLogin和clientRegister函数存在：


---

Read file: enterprise-frontend/src/api/user.js

---

很好，API函数已经存在。现在让我更新现有的登录页面，使用新的LoginForm组件：


---

<details><summary>Edit file: enterprise-frontend/src/views/client/Login.vue</summary>

undefined

**Chunk 1**
Lines added: 5, lines removed: 57

```diff
@@ -4,61 +4,9 @@
      
      <div class="login-container">
-       <div class="login-card">
-         <div class="login-header">
-           <h2>用户登录</h2>
-           <p>欢迎回到我们的企业官网</p>
-         </div>
-         
-         <el-form 
-           :model="loginForm" 
-           :rules="loginRules" 
-           ref="loginFormRef" 
-           class="login-form"
-           @submit.prevent="handleLogin"
-         >
-           <el-form-item prop="username">
-             <el-input 
-               v-model="loginForm.username" 
-               placeholder="用户名/邮箱/手机号"
-               size="large"
-             >
-               <template #prefix>
-                 <el-icon><User /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item prop="password">
-             <el-input 
-               v-model="loginForm.password" 
-               type="password" 
-               placeholder="密码"
-               size="large"
-               show-password
-             >
-               <template #prefix>
-                 <el-icon><Lock /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item>
-             <el-button 
-               type="primary" 
-               size="large" 
-               class="login-btn"
-               :loading="loading"
-               @click="handleLogin"
-             >
-               登录
-             </el-button>
-           </el-form-item>
-         </el-form>
-         
-         <div class="login-footer">
-           <p>还没有账号？ <router-link to="/register" class="register-link">立即注册</router-link></p>
-           <router-link to="/" class="back-link">返回首页</router-link>
-         </div>
-       </div>
+       <LoginForm 
+         initial-mode="login"
+         :redirect-to="redirectTo"
+         @login-success="handleLoginSuccess"
+       />
      </div>
      
```

**Chunk 2**
Lines added: 12, lines removed: 60

```diff
@@ -68,67 +16,19 @@
  
  <script setup>
- import { ref, reactive } from 'vue'
- import { useRouter } from 'vue-router'
- import { ElMessage } from 'element-plus'
- import { login, getCurrentUser } from '@/api/user'
+ import { ref, computed } from 'vue'
+ import { useRoute } from 'vue-router'
  import ClientHeader from '@/components/client/Header.vue'
  import ClientFooter from '@/components/client/Footer.vue'
- import { User, Lock } from '@element-plus/icons-vue'
+ import LoginForm from '@/components/client/LoginForm.vue'
  
- const router = useRouter()
- const loginFormRef = ref()
- const loading = ref(false)
- 
- const loginForm = reactive({
-   username: '',
-   password: ''
- })
- 
- const loginRules = {
-   username: [
-     { required: true, message: '请输入用户名', trigger: 'blur' }
-   ],
-   password: [
-     { required: true, message: '请输入密码', trigger: 'blur' },
-     { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
-   ]
- }
- 
- const handleLogin = async () => {
-   if (!loginFormRef.value) return
-   
-   try {
-     await loginFormRef.value.validate()
-     loading.value = true
-     
-     const response = await login(loginForm.username, loginForm.password)
-     
-     // 保存登录信息
-     localStorage.setItem('token', response.data.access_token)
-     
-     // 获取用户信息
-     try {
-       const userResponse = await getCurrentUser()
-       const userInfo = userResponse.data
-       localStorage.setItem('userInfo', JSON.stringify(userInfo))
-     } catch (userError) {
-       // 如果获取用户信息失败，使用基本信息
-       const userInfo = {
-         username: loginForm.username,
-         role: 'customer',
-         email: '',
-         phone: '',
-         avatar_url: ''
-       }
-       localStorage.setItem('userInfo', JSON.stringify(userInfo))
-     }
-     
-     ElMessage.success('登录成功')
-     router.push('/')
-   } catch (error) {
-     ElMessage.error(error.response?.data?.detail || '登录失败')
-   } finally {
-     loading.value = false
-   }
+ const route = useRoute()
+ 
+ // 获取重定向地址，默认为首页
+ const redirectTo = computed(() => {
+   return route.query.redirect || '/'
+ })
+ 
+ const handleLoginSuccess = (userData) => {
+   console.log('登录成功:', userData)
  }
  </script>
```

</details>

---

现在更新登录页面的样式：


---

<details><summary>Edit file: enterprise-frontend/src/views/client/Login.vue</summary>

undefined

**Chunk 1**
Lines added: undefined, lines removed: 77

```diff
@@ -48,80 +48,3 @@
    padding: 20px;
  }
- 
- .login-card {
-   background: white;
-   border-radius: 12px;
-   box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
-   padding: 40px;
-   width: 100%;
-   max-width: 400px;
-   border: 1px solid #e9ecef;
- }
- 
- .login-header {
-   text-align: center;
-   margin-bottom: 30px;
- }
- 
- .login-header h2 {
-   color: #333;
-   margin-bottom: 10px;
-   font-size: 28px;
-   font-weight: 600;
- }
- 
- .login-header p {
-   color: #666;
-   font-size: 16px;
- }
- 
- .login-form {
-   margin-bottom: 20px;
- }
- 
- .login-btn {
-   width: 100%;
-   height: 48px;
-   font-size: 16px;
-   font-weight: 500;
- }
- 
- .login-footer {
-   text-align: center;
-   margin-top: 20px;
- }
- 
- .register-link {
-   color: #409EFF;
-   text-decoration: none;
-   font-weight: 500;
- }
- 
- .register-link:hover {
-   text-decoration: underline;
- }
- 
- .back-link {
-   display: block;
-   margin-top: 15px;
-   color: #666;
-   text-decoration: none;
-   font-size: 14px;
- }
- 
- .back-link:hover {
-   color: #333;
- }
- 
- /* 响应式设计 */
- @media (max-width: 480px) {
-   .login-card {
-     padding: 30px 20px;
-     margin: 10px;
-   }
-   
-   .login-header h2 {
-     font-size: 24px;
-   }
- }
  </style> 
```

</details>

---

现在更新注册页面，使用新的LoginForm组件：


---

<details><summary>Edit file: enterprise-frontend/src/views/client/Register.vue</summary>

undefined

**Chunk 1**
Lines added: 5, lines removed: 95

```diff
@@ -4,99 +4,9 @@
      
      <div class="register-container">
-       <div class="register-card">
-         <div class="register-header">
-           <h2>用户注册</h2>
-           <p>加入我们的企业官网，享受更多服务</p>
-         </div>
-         
-         <el-form 
-           :model="registerForm" 
-           :rules="registerRules" 
-           ref="registerFormRef" 
-           class="register-form"
-           @submit.prevent="handleRegister"
-         >
-           <el-form-item prop="username">
-             <el-input 
-               v-model="registerForm.username" 
-               placeholder="用户名"
-               size="large"
-             >
-               <template #prefix>
-                 <el-icon><User /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item prop="email">
-             <el-input 
-               v-model="registerForm.email" 
-               placeholder="邮箱"
-               size="large"
-             >
-               <template #prefix>
-                 <el-icon><Message /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item prop="phone">
-             <el-input 
-               v-model="registerForm.phone" 
-               placeholder="手机号"
-               size="large"
-             >
-               <template #prefix>
-                 <el-icon><Phone /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item prop="password">
-             <el-input 
-               v-model="registerForm.password" 
-               type="password" 
-               placeholder="密码"
-               size="large"
-               show-password
-             >
-               <template #prefix>
-                 <el-icon><Lock /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item prop="confirmPassword">
-             <el-input 
-               v-model="registerForm.confirmPassword" 
-               type="password" 
-               placeholder="确认密码"
-               size="large"
-               show-password
-             >
-               <template #prefix>
-                 <el-icon><Lock /></el-icon>
-               </template>
-             </el-input>
-           </el-form-item>
-           
-           <el-form-item>
-             <el-button 
-               type="primary" 
-               size="large" 
-               class="register-btn"
-               :loading="loading"
-               @click="handleRegister"
-             >
-               注册
-             </el-button>
-           </el-form-item>
-         </el-form>
-         
-         <div class="register-footer">
-           <p>已有账号？ <router-link to="/login" class="login-link">立即登录</router-link></p>
-           <router-link to="/" class="back-link">返回首页</router-link>
-         </div>
-       </div>
+       <LoginForm 
+         initial-mode="register"
+         :redirect-to="redirectTo"
+         @register-success="handleRegisterSuccess"
+       />
      </div>
      
```

**Chunk 2**
Lines added: 13, lines removed: 103

```diff
@@ -106,109 +16,19 @@
  
  <script setup>
- import { ref, reactive } from 'vue'
- import { useRouter } from 'vue-router'
- import { ElMessage } from 'element-plus'
- import { register, login, getCurrentUser } from '@/api/user'
+ import { ref, computed } from 'vue'
+ import { useRoute } from 'vue-router'
  import ClientHeader from '@/components/client/Header.vue'
  import ClientFooter from '@/components/client/Footer.vue'
- import { User, Message, Phone, Lock } from '@element-plus/icons-vue'
- 
- const router = useRouter()
- const registerFormRef = ref()
- const loading = ref(false)
- 
- const registerForm = reactive({
-   username: '',
-   email: '',
-   phone: '',
-   password: '',
-   confirmPassword: ''
- })
- 
- const validateConfirmPassword = (rule, value, callback) => {
-   if (value === '') {
-     callback(new Error('请再次输入密码'))
-   } else if (value !== registerForm.password) {
-     callback(new Error('两次输入密码不一致'))
-   } else {
-     callback()
-   }
- }
- 
- const registerRules = {
-   username: [
-     { required: true, message: '请输入用户名', trigger: 'blur' },
-     { min: 3, max: 20, message: '用户名长度在 3 到 20 个字符', trigger: 'blur' }
-   ],
-   email: [
-     { required: true, message: '请输入邮箱地址', trigger: 'blur' },
-     { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }
-   ],
-   phone: [
-     { required: true, message: '请输入手机号', trigger: 'blur' },
-     { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }
-   ],
-   password: [
-     { required: true, message: '请输入密码', trigger: 'blur' },
-     { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
-   ],
-   confirmPassword: [
-     { required: true, validator: validateConfirmPassword, trigger: 'blur' }
-   ]
- }
- 
- const handleRegister = async () => {
-   if (!registerFormRef.value) return
-   
-   try {
-     await registerFormRef.value.validate()
-     loading.value = true
-     
-     const registerData = {
-       username: registerForm.username,
-       email: registerForm.email,
-       phone: registerForm.phone,
-       password: registerForm.password,
-       role: 'customer' // 客户端注册的用户默认为customer角色
-     }
-     
-     const response = await register(registerData)
-     
-     // 注册成功后，直接登录
-     try {
-       const loginResponse = await login(registerForm.username, registerForm.password)
-       
-       // 保存登录token
-       localStorage.setItem('token', loginResponse.data.access_token)
-       
-       // 获取用户详细信息
-       try {
-         const userResponse = await getCurrentUser()
-         const userInfo = userResponse.data
-         localStorage.setItem('userInfo', JSON.stringify(userInfo))
-       } catch (userError) {
-         // 如果获取用户信息失败，使用基本信息
-         const userInfo = {
-           username: registerForm.username,
-           email: registerForm.email,
-           phone: registerForm.phone,
-           role: 'customer',
-           avatar_url: ''
-         }
-         localStorage.setItem('userInfo', JSON.stringify(userInfo))
-       }
-       
-       ElMessage.success('注册成功，已自动登录')
-       router.push('/profile')
-     } catch (loginError) {
-       // 如果自动登录失败，跳转到登录页面
-       ElMessage.success('注册成功，请登录')
-       router.push('/login')
-     }
-   } catch (error) {
-     ElMessage.error(error.response?.data?.detail || '注册失败')
-   } finally {
-     loading.value = false
-   }
+ import LoginForm from '@/components/client/LoginForm.vue'
+ 
+ const route = useRoute()
+ 
+ // 获取重定向地址，默认为首页
+ const redirectTo = computed(() => {
+   return route.query.redirect || '/'
+ })
+ 
+ const handleRegisterSuccess = (userData) => {
+   console.log('注册成功:', userData)
  }
  </script>
```

</details>

---

现在更新注册页面的样式：


---

<details><summary>Edit file: enterprise-frontend/src/views/client/Register.vue</summary>

undefined

**Chunk 1**
Lines added: undefined, lines removed: 77

```diff
@@ -48,80 +48,3 @@
    padding: 20px;
  }
- 
- .register-card {
-   background: white;
-   border-radius: 12px;
-   box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
-   padding: 40px;
-   width: 100%;
-   max-width: 450px;
-   border: 1px solid #e9ecef;
- }
- 
- .register-header {
-   text-align: center;
-   margin-bottom: 30px;
- }
- 
- .register-header h2 {
-   color: #333;
-   margin-bottom: 10px;
-   font-size: 28px;
-   font-weight: 600;
- }
- 
- .register-header p {
-   color: #666;
-   font-size: 16px;
- }
- 
- .register-form {
-   margin-bottom: 20px;
- }
- 
- .register-btn {
-   width: 100%;
-   height: 48px;
-   font-size: 16px;
-   font-weight: 500;
- }
- 
- .register-footer {
-   text-align: center;
-   margin-top: 20px;
- }
- 
- .login-link {
-   color: #409EFF;
-   text-decoration: none;
-   font-weight: 500;
- }
- 
- .login-link:hover {
-   text-decoration: underline;
- }
- 
- .back-link {
-   display: block;
-   margin-top: 15px;
-   color: #666;
-   text-decoration: none;
-   font-size: 14px;
- }
- 
- .back-link:hover {
-   color: #333;
- }
- 
- /* 响应式设计 */
- @media (max-width: 480px) {
-   .register-card {
-     padding: 30px 20px;
-     margin: 10px;
-   }
-   
-   .register-header h2 {
-     font-size: 24px;
-   }
- }
  </style> 
```

</details>

---

现在我需要检查userStore，确保它有正确的方法：


---

Read file: enterprise-frontend/src/store/user.js

---

很好，userStore已经存在并且有正确的方法。现在让我删除不再需要的LoginModal组件：


---

undefined

---

现在让我测试一下前端是否能正常启动：


---

```bash
cd enterprise-frontend && npm run dev
```

---

让我检查一下是否有任何编译错误：


---

```bash
cd enterprise-frontend && npm run build
```

```

> enterprise-frontend@0.0.0 build
> vite build

vite v7.0.6 building for production...
✓ 738 modules transformed.
✗ Build failed in 1.38s
error during build:
Could not resolve "./LoginModal.vue" from "src/components/client/InquiryModal.vu
e"
file: /Users/huangqing/enterprise/enterprise-frontend/src/components/client/Inqu
iryModal.vue
    at getRollupError (file:///Users/huangqing/enterprise/enterprise-frontend/no
de_modules/rollup/dist/es/sh
ared/parseAst.js:401:41)
                                at error (file:///Users/huangqing/enterprise/ent
erprise-frontend/node_modules/rollup/dist/es/shared/pars
eAst.js:397:42)
                                at ModuleLoader.handleInvalidResolvedId (file://
/Users/huangqing/enterprise/enterprise-frontend/node_mod
ules/rollup/dist/es/shared/node-entry.js:21442:24)
                                at file:///Users/huangqing/enterprise/enterprise
-frontend/node_modules/rollup/dist/es/shared/node-entry.
js:21402:26
                            
```

---

看起来InquiryModal.vue文件中还在引用已删除的LoginModal.vue。让我检查并修复这个问题：


---

Read file: enterprise-frontend/src/components/client/InquiryModal.vue

---

我看到InquiryModal.vue中还在使用LoginModal。我需要修改这个组件，移除对LoginModal的依赖，改为路由跳转到登录页面：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 6

```diff
@@ -70,10 +70,5 @@
      </div>
      
-     <!-- 登录弹窗 -->
-     <LoginModal 
-       :visible="showLoginModal"
-       @close="hideLoginModal"
-       @login-success="handleLoginSuccess"
-     />
+ 
    </div>
  </template>
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -76,8 +76,8 @@
  <script>
  import { ref, watch, onMounted } from 'vue'
+ import { useRouter } from 'vue-router'
  import { createInquiry } from '@/api/inquiry'
  import { getImageUrl } from '@/utils/imageUtils'
  import { userStore } from '@/store/user'
- import LoginModal from './LoginModal.vue'
  
  export default {
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 3

```diff
@@ -83,7 +83,5 @@
  export default {
    name: 'InquiryModal',
-   components: {
-     LoginModal
-   },
+ 
    props: {
      visible: {
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -96,6 +96,6 @@
    emits: ['close', 'success'],
    setup(props, { emit }) {
+     const router = useRouter()
      const submitting = ref(false)
-     const showLoginModal = ref(false)
      const form = ref({
        name: '',
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 4, lines removed: 2

```diff
@@ -110,6 +110,8 @@
          // 检查用户登录状态
          if (!userStore.isLoggedIn) {
-           // 未登录，显示登录弹窗
-           showLoginModal.value = true
+           // 未登录，跳转到登录页面
+           router.push('/login?redirect=' + encodeURIComponent(window.location.pathname))
+           emit('close')
+           return
          } else {
            // 已登录，只自动填充邮箱和手机号，不填充姓名
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 16

```diff
@@ -131,20 +131,5 @@
      }
  
-     // 处理登录成功
-     const handleLoginSuccess = (userData) => {
-       hideLoginModal()
-       // 登录成功后只填充邮箱和手机号
-       fillUserInfo()
-     }
- 
-     // 显示登录弹窗
-     const showLoginModalFunc = () => {
-       showLoginModal.value = true
-     }
- 
-     // 隐藏登录弹窗
-     const hideLoginModal = () => {
-       showLoginModal.value = false
-     }
+ 
  
      // 处理弹窗点击（点击空白区域不关闭）
```

</details>

---

<details><summary>Edit file: enterprise-frontend/src/components/client/InquiryModal.vue</summary>

undefined

**Chunk 1**
Lines added: undefined, lines removed: 4

```diff
@@ -197,12 +197,8 @@
        submitting,
        form,
-       showLoginModal,
        handleClose,
        handleSubmit,
        getImageUrl,
        fillUserInfo,
-       handleLoginSuccess,
-       showLoginModalFunc,
-       hideLoginModal,
        handleModalClick
      }
```

</details>

---

现在让我再次尝试构建项目：


---

```bash
npm run build
```

```
huangqing@192 enterprise-frontend % npm run build

> enterprise-frontend@0.0.0 build
> vite build

vite v7.0.6 building for production...
✓ 1578 modules transformed.
dist/index.html                     0.43 kB │ gzip:   0.29 kB
dist/assets/index-B_EDdIOx.css    413.24 kB │ gzip:  57.61 kB
dist/assets/index-BsLHEPh4.js   2,168.88 kB │ gzip: 727.22 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-option
s/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 5.31s
huangqing@192 enterprise-frontend %
```

---

太好了！构建成功了。现在让我启动开发服务器来测试功能：


---

```bash
npm run dev
```

---

现在让我创建一个简单的测试页面来验证登录和注册功能是否正常工作。首先，让我检查一下是否有任何其他文件还在引用LoginModal：


---

<details>
            <summary>Grep search for "LoginModal" • **0** files</summary>
        
No results found
</details>

---

很好！现在让我创建一个简单的使用示例，展示如何在其他页面中使用LoginForm组件：


---

<details><summary>Edit file: enterprise-frontend/src/components/client/LoginForm.vue</summary>

在LoginForm组件的顶部添加使用说明注释

**Chunk 1**
Lines added: 45, lines removed: undefined

```diff
@@ -1,2 +1,47 @@
+ <!--
+ LoginForm 组件使用说明：
+ 
+ 这是一个可复用的登录/注册表单组件，支持以下功能：
+ 
+ 1. 登录和注册功能集成在一个组件中
+ 2. 支持通过 initialMode 属性设置初始模式（'login' 或 'register'）
+ 3. 支持通过 redirectTo 属性设置登录成功后的跳转地址
+ 4. 支持通过 onSuccess 回调函数处理登录/注册成功事件
+ 5. 支持通过 @login-success 和 @register-success 事件监听成功事件
+ 
+ 使用示例：
+ 
+ 1. 在页面中使用：
+ <template>
+   <div>
+     <LoginForm 
+       initial-mode="login"
+       :redirect-to="/profile"
+       @login-success="handleLoginSuccess"
+     />
+   </div>
+ </template>
+ 
+ 2. 在弹窗中使用：
+ <template>
+   <div v-if="showLogin" class="modal">
+     <LoginForm 
+       initial-mode="register"
+       :redirect-to="/"
+       @register-success="handleRegisterSuccess"
+     />
+   </div>
+ </template>
+ 
+ Props:
+ - initialMode: String - 初始模式，'login' 或 'register'，默认为 'login'
+ - onSuccess: Function - 登录/注册成功回调函数
+ - redirectTo: String - 登录成功后的跳转地址，默认为 '/'
+ 
+ Events:
+ - login-success: 登录成功时触发，参数为用户数据
+ - register-success: 注册成功时触发，参数为注册响应数据
+ -->
+ 
  <template>
    <div class="auth-form-container">
```

</details>

---

现在让我创建一个总结文档，说明我们所做的改动：


---

<details><summary>Edit file: enterprise-frontend/LOGIN_REGISTER_REFACTOR_SUMMARY.md</summary>

创建一个总结文档，说明登录注册功能的重构

**Chunk 1**
Lines added: 174, lines removed: 1

```diff
@@ -1,1 +1,174 @@
- 
+ # 登录注册功能重构总结
+ 
+ ## 改动概述
+ 
+ 将客户端的登录和注册功能从弹窗形式改为页面形式，并创建了可复用的组件。
+ 
+ ## 主要改动
+ 
+ ### 1. 创建可复用的 LoginForm 组件
+ 
+ **文件位置**: `src/components/client/LoginForm.vue`
+ 
+ **功能特点**:
+ - 集成登录和注册功能于一个组件中
+ - 支持通过 `initialMode` 属性设置初始模式（'login' 或 'register'）
+ - 支持通过 `redirectTo` 属性设置登录成功后的跳转地址
+ - 支持事件监听和回调函数处理成功事件
+ - 响应式设计，适配移动端
+ 
+ **使用示例**:
+ ```vue
+ <template>
+   <LoginForm 
+     initial-mode="login"
+     :redirect-to="/profile"
+     @login-success="handleLoginSuccess"
+   />
+ </template>
+ ```
+ 
+ ### 2. 更新 Header 组件
+ 
+ **文件位置**: `src/components/client/Header.vue`
+ 
+ **改动内容**:
+ - 移除 LoginModal 组件的引用
+ - 将登录和注册按钮改为 router-link 路由跳转
+ - 移除弹窗相关的状态和方法
+ - 更新按钮样式以适配 router-link
+ 
+ ### 3. 更新登录页面
+ 
+ **文件位置**: `src/views/client/Login.vue`
+ 
+ **改动内容**:
+ - 使用新的 LoginForm 组件替换原有的 Element Plus 表单
+ - 简化页面逻辑，移除复杂的表单验证和提交逻辑
+ - 支持通过 URL 参数设置重定向地址
+ - 保持页面布局和样式
+ 
+ ### 4. 更新注册页面
+ 
+ **文件位置**: `src/views/client/Register.vue`
+ 
+ **改动内容**:
+ - 使用新的 LoginForm 组件替换原有的 Element Plus 表单
+ - 简化页面逻辑
+ - 支持通过 URL 参数设置重定向地址
+ - 保持页面布局和样式
+ 
+ ### 5. 更新 InquiryModal 组件
+ 
+ **文件位置**: `src/components/client/InquiryModal.vue`
+ 
+ **改动内容**:
+ - 移除 LoginModal 组件的引用
+ - 将未登录时的处理改为路由跳转到登录页面
+ - 支持通过 URL 参数传递重定向地址
+ 
+ ### 6. 删除不再需要的文件
+ 
+ **删除文件**: `src/components/client/LoginModal.vue`
+ 
+ ## 功能特性
+ 
+ ### 1. 页面路由
+ - `/login` - 登录页面
+ - `/register` - 注册页面
+ - 支持通过 `?redirect=` 参数设置登录成功后的跳转地址
+ 
+ ### 2. 用户体验
+ - 登录和注册在同一个组件中，可以快速切换
+ - 表单验证和错误提示
+ - 加载状态显示
+ - 响应式设计
+ 
+ ### 3. 组件复用
+ - LoginForm 组件可以在任何地方使用
+ - 支持不同的初始模式和配置
+ - 支持事件监听和回调处理
+ 
+ ## 技术实现
+ 
+ ### 1. API 调用
+ - 使用 `clientLogin` 和 `clientRegister` API
+ - 自动处理 token 存储和用户信息更新
+ - 错误处理和用户提示
+ 
+ ### 2. 状态管理
+ - 使用 userStore 管理用户状态
+ - 自动检查登录状态
+ - 支持登录和登出功能
+ 
+ ### 3. 路由处理
+ - 支持重定向参数
+ - 登录成功后自动跳转
+ - 未登录时跳转到登录页面
+ 
+ ## 使用方式
+ 
+ ### 1. 在页面中使用
+ ```vue
+ <template>
+   <div>
+     <LoginForm 
+       initial-mode="login"
+       :redirect-to="/profile"
+       @login-success="handleLoginSuccess"
+     />
+   </div>
+ </template>
+ ```
+ 
+ ### 2. 在弹窗中使用
+ ```vue
+ <template>
+   <div v-if="showLogin" class="modal">
+     <LoginForm 
+       initial-mode="register"
+       :redirect-to="/"
+       @register-success="handleRegisterSuccess"
+     />
+   </div>
+ </template>
+ ```
+ 
+ ### 3. 路由跳转
+ ```javascript
+ // 跳转到登录页面
+ router.push('/login')
+ 
+ // 跳转到登录页面并设置重定向
+ router.push('/login?redirect=' + encodeURIComponent('/profile'))
+ 
+ // 跳转到注册页面
+ router.push('/register')
+ ```
+ 
+ ## 测试建议
+ 
+ 1. 测试登录功能
+    - 使用正确的用户名和密码登录
+    - 使用错误的用户名和密码测试错误处理
+    - 测试登录成功后的跳转
+ 
+ 2. 测试注册功能
+    - 使用有效信息注册
+    - 测试密码确认验证
+    - 测试必填字段验证
+ 
+ 3. 测试组件复用
+    - 在不同页面中使用 LoginForm 组件
+    - 测试不同的初始模式和配置
+ 
+ 4. 测试响应式设计
+    - 在不同屏幕尺寸下测试
+    - 测试移动端体验
+ 
+ ## 注意事项
+ 
+ 1. 确保后端 API 正常工作
+ 2. 检查 userStore 的状态管理
+ 3. 验证路由配置正确
+ 4. 测试错误处理和用户提示 
```

</details>

---

## 总结

我已经成功将客户端的登录和注册功能从弹窗形式改为页面形式，并创建了可复用的组件。主要完成了以下工作：

### �� 主要改动

1. **创建了可复用的 LoginForm 组件** (`src/components/client/LoginForm.vue`)
   - 集成登录和注册功能于一个组件中
   - 支持通过 `initialMode` 属性设置初始模式
   - 支持通过 `redirectTo` 属性设置跳转地址
   - 支持事件监听和回调处理

2. **更新了 Header 组件**
   - 移除弹窗形式的登录
   - 将登录和注册按钮改为路由跳转
   - 更新了按钮样式

3. **重构了登录和注册页面**
   - 使用新的 LoginForm 组件
   - 简化了页面逻辑
   - 保持了原有的页面布局

4. **更新了 InquiryModal 组件**
   - 移除对 LoginModal 的依赖
   - 改为路由跳转到登录页面

5. **删除了不再需要的文件**
   - 删除了 `LoginModal.vue` 组件

### ✨ 功能特性

- **页面路由**: `/login` 和 `/register` 页面
- **用户体验**: 登录和注册在同一个组件中，可以快速切换
- **组件复用**: LoginForm 组件可以在任何地方使用
- **响应式设计**: 适配移动端和桌面端
- **重定向支持**: 支持通过 URL 参数设置登录成功后的跳转地址

### �� 技术实现

- 使用 `clientLogin` 和 `clientRegister` API
- 使用 userStore 管理用户状态
- 支持路由跳转和重定向
- 完整的错误处理和用户提示

现在客户端的前端登录和注册功能已经完全改为页面形式，并且封装成了可复用的组件，方便在其他地方调用使用。

---

